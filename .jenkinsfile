pipeline{
    agent any
    stages {
        stage ("docker build"){
            steps{
                script{
                        def commitHash = sh(script: 'git rev-parse HEAD', returnStdout: true).trim()
                        sh "docker build -t trankimtep/$env.JOB_NAME:$commitHash ."         
                    
                }                
            }
        }
        stage ("docker push"){
            steps{
                withCredentials([usernamePassword(credentialsId: 'dockerHub', passwordVariable: 'dockerHubPassword', usernameVariable: 'dockerHubUser')]) {
        	        sh "docker login -u ${env.dockerHubUser} -p ${env.dockerHubPassword}"
                    sh 'docker push trankimtep/$env.JOB_NAME:$commitHash'
                }
            }
        }
    }
}